@model LearninngManagementSystem.Models.BookingConfirmationVM
@{
    ViewBag.Title = "BookingConfirmedView";
}
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<div class="container">
    <h2 class="text-secondary text-center mb-3">Booking Confirmed</h2>
    <div class="row">
        <div id="bookingCard">
            <div class="card mx-auto bg-secondary rounded-2 w-50">
                <div class="text-center">
                    <h5>Booking Confirmed with the following details:</h5>
                </div>
                <div class="ms-4 mt-3 me-3">
                    <p><strong>Booking ID:</strong> @Model.BookingNo</p>
                    <p><strong>Date Booked:</strong> @Model.DateMade.ToString("dd MMM yyyy HH:mm")</p>

                    <p><strong>Slot Date:</strong> @Model.SlotDate.ToString("dd MMM yyyy")</p>
                    <p><strong>Slot Time:</strong> @Model.StartTime.ToString(@"hh\:mm") - @Model.EndTime.ToString(@"hh\:mm")</p>

                    <hr />

                    <p><strong>Parent:</strong> @Model.P_FullName (@Model.P_PhoneNumber)</p>
                    <p><strong>Learner:</strong> @Model.L_FullName (@Model.L_PhoneNumber)</p>
                    <p><strong>Grade:</strong> @Model.Grade</p>
                    <p><strong>Home Language:</strong> @Model.Home_Language</p>

                </div>
                <div class="mt-5 text-center">
                    <p>Thank You for making a booking.</p>
                    <p>Please present your booking confirmation at the reception on the day</p>
                    <p>We can't wait to see you on @Model.SlotDate </p>
                </div>
            </div>
        </div>
    </div>
    <div class="text-center">
        <a class="btn btn-success" id="ConfirmationDownload" href="#">Download Confirmation</a>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const bookingNo = "@Model.BookingNo";

    if (!bookingNo) {
        alert("No booking found");
        return;
    }

    document.getElementById("ConfirmationDownload").addEventListener("click", function (e) {
        e.preventDefault();

        const bookingCard = document.getElementById("bookingCard");

        if (!bookingCard) {
            alert("Booking card not found");
            return;
        }

        html2canvas(bookingCard).then(canvas => {

            const imageData = canvas.toDataURL("image/png");

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF("p", "pt", "a4");

            const pageWidth = pdf.internal.pageSize.getWidth();
            const imgWidth = canvas.width;
            const imgHeight = canvas.height;

            const ratio = Math.min(pageWidth / imgWidth, 1);
            const scaledWidth = imgWidth * ratio;
            const scaledHeight = imgHeight * ratio;

            const xOffset = (pageWidth - scaledWidth) / 2;

            pdf.addImage(imageData, "PNG", xOffset, 40, scaledWidth, scaledHeight);
            pdf.save("BookingConfirmation.pdf");
        });
    });

});
</script>


